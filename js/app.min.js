function stackBlurImage(e,t,i,a){var r=e,n=r.width,s=r.height,t=t;t.style.width=n+"px",t.style.height=s+"px",t.width=n,t.height=s;var o=t.getContext("2d");o.clearRect(0,0,n,s),o.drawImage(r,0,0,n,s),isNaN(i)||1>i||(a?stackBlurCanvasRGBA(t,0,0,n,s,i):stackBlurCanvasRGB(t,0,0,n,s,i))}function stackBlurCanvasRGBA(e,t,i,a,r,n){if(!(isNaN(n)||1>n)){n|=0;var s,e=e,o=e.getContext("2d");try{try{s=o.getImageData(t,i,a,r)}catch(l){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),s=o.getImageData(t,i,a,r)}catch(l){throw alert("Cannot access local image"),new Error("unable to access local image data: "+l)}}}catch(l){throw alert("Cannot access image"),new Error("unable to access image data: "+l)}var c,h,p,f,d,u,m,g,v,y,b,x,w,$,T,C,k,_,B,L,I,S,D,q,M=s.data,R=n+n+1,E=a-1,O=r-1,z=n+1,N=z*(z+1)/2,G=new BlurStack,P=G;for(p=1;R>p;p++)if(P=P.next=new BlurStack,p==z)var A=P;P.next=G;var H=null,U=null;m=u=0;var X=mul_table[n],j=shg_table[n];for(h=0;r>h;h++){for(C=k=_=B=g=v=y=b=0,x=z*(L=M[u]),w=z*(I=M[u+1]),$=z*(S=M[u+2]),T=z*(D=M[u+3]),g+=N*L,v+=N*I,y+=N*S,b+=N*D,P=G,p=0;z>p;p++)P.r=L,P.g=I,P.b=S,P.a=D,P=P.next;for(p=1;z>p;p++)f=u+((p>E?E:p)<<2),g+=(P.r=L=M[f])*(q=z-p),v+=(P.g=I=M[f+1])*q,y+=(P.b=S=M[f+2])*q,b+=(P.a=D=M[f+3])*q,C+=L,k+=I,_+=S,B+=D,P=P.next;for(H=G,U=A,c=0;a>c;c++)M[u+3]=D=b*X>>j,0!=D?(D=255/D,M[u]=(g*X>>j)*D,M[u+1]=(v*X>>j)*D,M[u+2]=(y*X>>j)*D):M[u]=M[u+1]=M[u+2]=0,g-=x,v-=w,y-=$,b-=T,x-=H.r,w-=H.g,$-=H.b,T-=H.a,f=m+((f=c+n+1)<E?f:E)<<2,C+=H.r=M[f],k+=H.g=M[f+1],_+=H.b=M[f+2],B+=H.a=M[f+3],g+=C,v+=k,y+=_,b+=B,H=H.next,x+=L=U.r,w+=I=U.g,$+=S=U.b,T+=D=U.a,C-=L,k-=I,_-=S,B-=D,U=U.next,u+=4;m+=a}for(c=0;a>c;c++){for(k=_=B=C=v=y=b=g=0,u=c<<2,x=z*(L=M[u]),w=z*(I=M[u+1]),$=z*(S=M[u+2]),T=z*(D=M[u+3]),g+=N*L,v+=N*I,y+=N*S,b+=N*D,P=G,p=0;z>p;p++)P.r=L,P.g=I,P.b=S,P.a=D,P=P.next;for(d=a,p=1;n>=p;p++)u=d+c<<2,g+=(P.r=L=M[u])*(q=z-p),v+=(P.g=I=M[u+1])*q,y+=(P.b=S=M[u+2])*q,b+=(P.a=D=M[u+3])*q,C+=L,k+=I,_+=S,B+=D,P=P.next,O>p&&(d+=a);for(u=c,H=G,U=A,h=0;r>h;h++)f=u<<2,M[f+3]=D=b*X>>j,D>0?(D=255/D,M[f]=(g*X>>j)*D,M[f+1]=(v*X>>j)*D,M[f+2]=(y*X>>j)*D):M[f]=M[f+1]=M[f+2]=0,g-=x,v-=w,y-=$,b-=T,x-=H.r,w-=H.g,$-=H.b,T-=H.a,f=c+((f=h+z)<O?f:O)*a<<2,g+=C+=H.r=M[f],v+=k+=H.g=M[f+1],y+=_+=H.b=M[f+2],b+=B+=H.a=M[f+3],H=H.next,x+=L=U.r,w+=I=U.g,$+=S=U.b,T+=D=U.a,C-=L,k-=I,_-=S,B-=D,U=U.next,u+=a}o.putImageData(s,t,i)}}function stackBlurCanvasRGB(e,t,i,a,r,n){if(!(isNaN(n)||1>n)){n|=0;var s,e=e,o=e.getContext("2d");try{try{s=o.getImageData(t,i,a,r)}catch(l){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),s=o.getImageData(t,i,a,r)}catch(l){throw alert("Cannot access local image"),new Error("unable to access local image data: "+l)}}}catch(l){throw alert("Cannot access image"),new Error("unable to access image data: "+l)}var c,h,p,f,d,u,m,g,v,y,b,x,w,$,T,C,k,_,B,L,I=s.data,S=n+n+1,D=a-1,q=r-1,M=n+1,R=M*(M+1)/2,E=new BlurStack,O=E;for(p=1;S>p;p++)if(O=O.next=new BlurStack,p==M)var z=O;O.next=E;var N=null,G=null;m=u=0;var P=mul_table[n],A=shg_table[n];for(h=0;r>h;h++){for($=T=C=g=v=y=0,b=M*(k=I[u]),x=M*(_=I[u+1]),w=M*(B=I[u+2]),g+=R*k,v+=R*_,y+=R*B,O=E,p=0;M>p;p++)O.r=k,O.g=_,O.b=B,O=O.next;for(p=1;M>p;p++)f=u+((p>D?D:p)<<2),g+=(O.r=k=I[f])*(L=M-p),v+=(O.g=_=I[f+1])*L,y+=(O.b=B=I[f+2])*L,$+=k,T+=_,C+=B,O=O.next;for(N=E,G=z,c=0;a>c;c++)I[u]=g*P>>A,I[u+1]=v*P>>A,I[u+2]=y*P>>A,g-=b,v-=x,y-=w,b-=N.r,x-=N.g,w-=N.b,f=m+((f=c+n+1)<D?f:D)<<2,$+=N.r=I[f],T+=N.g=I[f+1],C+=N.b=I[f+2],g+=$,v+=T,y+=C,N=N.next,b+=k=G.r,x+=_=G.g,w+=B=G.b,$-=k,T-=_,C-=B,G=G.next,u+=4;m+=a}for(c=0;a>c;c++){for(T=C=$=v=y=g=0,u=c<<2,b=M*(k=I[u]),x=M*(_=I[u+1]),w=M*(B=I[u+2]),g+=R*k,v+=R*_,y+=R*B,O=E,p=0;M>p;p++)O.r=k,O.g=_,O.b=B,O=O.next;for(d=a,p=1;n>=p;p++)u=d+c<<2,g+=(O.r=k=I[u])*(L=M-p),v+=(O.g=_=I[u+1])*L,y+=(O.b=B=I[u+2])*L,$+=k,T+=_,C+=B,O=O.next,q>p&&(d+=a);for(u=c,N=E,G=z,h=0;r>h;h++)f=u<<2,I[f]=g*P>>A,I[f+1]=v*P>>A,I[f+2]=y*P>>A,g-=b,v-=x,y-=w,b-=N.r,x-=N.g,w-=N.b,f=c+((f=h+M)<q?f:q)*a<<2,g+=$+=N.r=I[f],v+=T+=N.g=I[f+1],y+=C+=N.b=I[f+2],N=N.next,b+=k=G.r,x+=_=G.g,w+=B=G.b,$-=k,T-=_,C-=B,G=G.next,u+=a}o.putImageData(s,t,i)}}function BlurStack(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];!function(e){function t(t){this.$el=e(t)}function i(){console.log("shooting bananas");for(var t=.8,i=Math.ceil(4*Math.random()+1),r=[0,-20],n=e(".bananas"),s=0;i>s;s++){var o=e('<div class="shooting-banana" />'),l=10*(.5-Math.random()),c=20*-Math.random();console.log("initial x velocity:",l+", initial y velocity:",c),n.append(o),a(o,r,l,c,t)}}function a(e,t,i,r,n){var s=t[0]+i,o=t[1]+r,l="matrix(1, 0, 0, 1, "+s+", "+o+")";r+=n,e[0].style.webkitTransform=l,e[0].style.MozTransform=l,e[0].style.msTransform=l,e[0].style.OTransform=l,e[0].style.transform=l,20>o?requestAnimationFrame(function(){a(e,[s,o],i,r,n)}):e.remove()}e(".input-wrapper").on("focus","input, textarea",function(){e(this).parent(".input-wrapper").addClass("focused")}).on("blur","input, textarea",function(){e(this).parent(".input-wrapper").removeClass("focused")}),e(".select-box").on("change","select",function(){this.value?e(this).parent(".select-box").addClass("selected"):e(this).parent(".select-box").removeClass("selected")}),e(".date-input input").datepicker({autoclose:!0,format:"mm/dd/yyyy"}).on("changeDate",function(){e(this).parent().addClass("selected")}),e(".input-switch").on("change",function(){var t=e(this).data("switchto"),i=e(this).parents(".row").find(".switch-target");i.removeClass("active").filter("#"+t).addClass("active")}),e(".request-quote-form").length>0&&(e(".request-quote-form").validationEngine("attach",{showArrow:!1,binded:!1,promptPosition:"bottomLeft",custom_error_messages:{required:{message:"Oops, looks like you forgot to add this field"},"#url":{"custom[url]":{message:"That doesn't look like the URLs we're used to."}}}}),e(".request-quote-form").on("blur",".form-part1 input",function(){var t=e(this),i=e(".request-quote-form").find(".monkee-step"),a=e(".request-quote-form").find(".monkee"),r=!t.validationEngine("validate");r?t.parent().is(":last-child")&&t.parents(".form-step").addClass("complete"):t.parents(".form-step").removeClass("complete");var n=i.filter(".complete").length;if(n>0){var s=1-n/i.length;a.children(".dark-monkee").css("opacity",s),console.log("opacity should be",s)}n===i.length?a.addClass("speak"):a.removeClass("speak")}));var r=function(t){this.$el=e(t),this.$screenContainer=this.$el.find(".screens"),this.$screens=this.$screenContainer.children(".screen"),this.$thumbs=this.$el.find(".thumbs"),this.ratios={desktop:.727,tablet:1.328,phone:2.08},this.margin=160,this.width=this.$screenContainer.width(),this.thumbRatio=.2,this.activeSlide="desktop",this.siteName=this.$el.data("site")};if(r.prototype._getX=function(t,i,a){var r=(this.width-e(i).width()*a)/2;return"left"==t?-r:r},r.prototype._moveSlide=function(e,t,i){var a=i?i:this.thumbRatio,r="active"==t?1:a,n="active"==t?0:this._getX(t,e,a);console.log("moving slide",e,"to position",t),TweenLite.to(e,.5,{scale:r,x:n})},r.prototype.transitionSlides=function(e){this.$screenContainer.hasClass("initial")&&this.$screenContainer.removeClass("initial");for(var t in this.$screens){var i,a=this.$screens[t],r=a.hasClass("active")?"active":a.hasClass("right")?"right":"left";i="active"==r&&"right"==e||"right"==r&&"left"==e?"left":"left"==r&&"right"==e||"active"==r&&"left"==e?"right":"active","active"==r||"active"==i?a.css("z-index",2):a.css("z-index",1),this._moveSlide(a,i),a.removeClass(r).addClass(i)}},r.prototype.updateScreen=function(e){for(var t in this.$screens){var i=this.$screens[t].children(".screen-inner"),a="/assets/port-"+this.siteName+"-"+t+"-"+e+".png",r=document.createElement("img");r.src=a,i.html(r)}},r.prototype.init=function(){var t=this.width-2*this.margin,i=this.$screenContainer.height(),a=this,r={};this.$screens.each(function(){var n=e(this),s=n.data("device"),o=a.ratios[s]>1?i:t*a.ratios[s],l=a.ratios[s]<1?t:i/a.ratios[s];n.css({height:o+"px",width:l+"px",left:t/2-l/2+a.margin+"px",top:i/2-o/2+"px"}),r[s]=n}),this.$screens=r,a._moveSlide(this.$screens.phone,"left",.6),a._moveSlide(this.$screens.tablet,"right",.6),e(".slider-nav").on("click","a",function(t){t.preventDefault(),a.transitionSlides(e(this).hasClass("port-left")?"left":"right")}),this.$thumbs.on("click",".thumbnail",function(t){t.preventDefault(),a.$thumbs.find(".thumbnail").removeClass("active"),e(this).addClass("active");var i=e(this).data("screen");a.updateScreen(i)})},e(".port-slider").length>0){var n=new r(".port-slider");n.init()}var s=function(t){this.$el=e(t),this.$circles=this.$el.find(".circle"),this.$expander=this.$el.find(".circle-expander"),this.$cur_circle=null};s.prototype._placeBG=function(){var t=this.$el.offset(),i=this.$el.width(),a=this.$el.height();this.$circles.each(function(){var r=e(this),n=r.offset(),s=r.children(".bg");s.css({top:t.top-n.top+"px",left:t.left-n.left+"px",width:i+"px",height:a+"px"})})},s.prototype._animateInTitle=function(e){var t=this,i=this.$expander.children(".title-overlay"),a=this.$cur_circle.data("name"),r=this.$expander.children(".expander-nav").children("a").not("."+a);TweenLite.set(r.last(),{x:160,right:0,left:"auto",delay:e}),TweenLite.set(r.first(),{x:-160,left:0,right:"auto",delay:e,onComplete:function(){i.html(t.$cur_circle.siblings(".tagline").html())}}),TweenLite.to(i,.5,{y:40,delay:e,ease:Back.easeOut}),TweenLite.to(r,.15,{x:0,delay:e+.5})},s.prototype._animateOutTitle=function(){var e=this.$expander.children(".title-overlay"),t=this.$cur_circle.data("name"),i=this.$expander.children(".expander-nav").children("a").not("."+t);TweenLite.to(e,.5,{y:e.outerHeight()}),TweenLite.to(i.first(),.15,{x:-160}),TweenLite.to(i.last(),.15,{x:160})},s.prototype._animateIn=function(t){var i=e(t),a=i.siblings(".border"),r=i.children(".bg").data("bg");this.$cur_circle=i,this.$expander.css("z-index",4),this.$expander.children(".bg").css("background-image","url("+r+")"),i.parent("li").addClass("active"),TweenLite.to(a,.3,{scale:7}),TweenLite.to(this.$expander,.5,{opacity:1,delay:.5,onComplete:function(){TweenLite.set(a,{scale:1})}}),this._animateInTitle(1)},s.prototype._animateOut=function(){var e=this;this.$el.find("li").removeClass("active"),this._animateOutTitle(),TweenLite.to(this.$expander,.5,{opacity:0,delay:.5,onComplete:function(){e.$expander.css({"z-index":-1})}})},s.prototype._animateSwitch=function(t){this._animateOutTitle(),this.$cur_circle=e(t);var i=this.$cur_circle.children(".bg").data("bg"),a=this.$expander.children(".bg");this.$el.find("li").removeClass("active"),this.$cur_circle.parent("li").addClass("active"),TweenLite.to(a,.3,{opacity:0,delay:.5,onComplete:function(){a.css("background-image","url("+i+")"),TweenLite.to(a,.3,{opacity:1})}}),this._animateInTitle(1)},s.prototype.init=function(){var t=this;this._placeBG(),this.$el.on("click",".circle",function(){t._animateIn(this)}),this.$el.find(".close-btn").on("click",function(e){e.preventDefault(),t._animateOut()}),this.$expander.children(".expander-nav").on("click","a",function(i){i.preventDefault();var a=e(this).attr("class"),r=t.$el.find("ul ."+a);console.log("new class is",a,"new circle is",r[0]),t._animateSwitch(r)})};var o=new s(".hero-circles");if(o.init(),e(".troop-list").on("click",".trigger",function(t){t.preventDefault();var i=e(this),a=i.parent(),r=i.parents(".troop-list"),n=i.siblings(".profile-content");if(a.hasClass("active"))return a.removeClass("active"),void r.children("li").removeClass("inactive");r.children("li").not(a).removeClass("active").addClass("inactive"),a.removeClass("inactive").addClass("active");var s=a.position().top+a.outerHeight();n.css("top",s+"px")}),t.prototype.blurImage=function(){console.log("blur image"),this.$image=this.$el.find(".image-bg");var t=this;this.$image.on("load",function(){var i=t.$el.outerWidth(),a=t.$el.outerHeight(),r=t.$image.width(),n=t.$image.height(),s=0,o=0,l=0,c=0;if(r/n>i/a?(s=a*(r/n),o=a,l=-(s-i)/2):(s=i,o=i*(n/r),c=-(o-a)/2),t.$image.css({width:s+"px",height:o+"px",left:l+"px",top:c+"px",display:"block"}),Modernizr.canvas&&!Modernizr.touch){var h=document.createElement("canvas");h.width=s,h.height=o,h.style.left=l+"px",h.style.top=c+"px",t.$el.append(h);var p=e(window),f=new TweenLite.to(h,1,{opacity:1,paused:!0}),d=function(){var e=p.scrollTop(),i=1/(t.$el.height()-80)*e;i>=0&&1>=i&&f.progress(i)};stackBlurImage(t.$image[0],h,40,!1),p.on("scroll",d)}}).each(function(){})},e(".blur-image").length>0){var l=new t(".blur-image");l.blurImage()}if(e("#contact-map").length>0){var c=[{featureType:"landscape",elementType:"all",stylers:[{color:"#dbf1ee"},{visibility:"on"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#b4d7e6"},{visibility:"on"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#69bfb2"},{visibility:"on"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#ffffff"},{visibility:"on"}]},{featureType:"road.arterial",elementType:"all",stylers:[{color:"#ffffff"},{visibility:"simplified"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#bcca7f"},{visibility:"on"}]},{featureType:"road.local",elementType:"all",stylers:[{color:"#d6ebe8"},{visibility:"off"}]},{featureType:"poi.attraction",elementType:"geometry.fill",stylers:[{color:"#cce5e1"},{visibility:"on"}]},{featureType:"poi.place_of_worship",elementType:"geometry.fill",stylers:[{color:"#cce5e1"},{visibility:"on"}]},{featureType:"poi.government",elementType:"geometry.fill",stylers:[{color:"#cce5e1"},{visibility:"on"}]},{featureType:"poi.school",elementType:"geometry.fill",stylers:[{color:"#cce5e1"},{visibility:"on"}]},{featureType:"poi.business",elementType:"geometry.fill",stylers:[{color:"#bcd7d2"},{visibility:"on"}]},{featureType:"poi.medical",elementType:"geometry",stylers:[{color:"#e5fbf8"},{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{hue:"#ffffff"},{saturation:-100},{lightness:100},{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{hue:"#ffffff"},{saturation:0},{lightness:100},{visibility:"off"}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{color:"#e6faf8"},{visibility:"off"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.fill",stylers:[{color:"#42454c"},{visibility:"on"}]},{featureType:"road.local",elementType:"all",stylers:[{color:"#cbe7e3"},{visibility:"simplified"}]}],h=new google.maps.LatLng(30.383294,-97.743659),p="/images/map-marker.png",f=new google.maps.Map(document.getElementById("contact-map"),{zoom:14,center:h,styles:c}),d=new google.maps.Marker({map:f,animation:google.maps.Animation.DROP,position:h,icon:p});d.setMap(f)}e(".bananas").on("mouseenter",i)}(jQuery);